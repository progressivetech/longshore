#!/bin/bash

long_usage_message="usage: $(basename $0) sibling-backup
Sync backups from this sibling to the other siblings."

long_check_args "$2" "$#" 0
host=$(hostname)
backups_path="/srv/longshore/ptp-backups/${host}"

# We only rsync files younger than 6 months to all servers to save disk space.
for sibling in $LONG_SIBLINGS; do
  find "$backups_path" -type f -mtime -180 -exec rsync -a --delete "{}" ${sibling}.mayfirst.org:"${backups_path}/" \;
done

